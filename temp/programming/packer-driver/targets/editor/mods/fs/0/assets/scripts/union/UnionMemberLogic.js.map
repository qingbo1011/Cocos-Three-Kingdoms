{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/union/UnionMemberLogic.ts"],"names":["_decorator","Component","ScrollView","Node","instantiate","UnionCommand","MapCommand","UnionMemberItemOpLogic","EventMgr","ccclass","property","UnionMemberLogic","onLoad","on","updateMember","getMember","onClickItem","onDestroy","targetOff","click","_op","active","menberData","node","opNode","parent","getComponent","setData","data","city","getInstance","cityProxy","getMyMainCity","unionData","proxy","getUnion","unionId","comp","memberView","list","getMemberList","id","concat","updateBtn","getChairman","rid","exitButton","disMissButton","unionMember","onEnable","dismiss","unionDismiss","exit","unionExit"],"mappings":"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","sourcesContent":["import { _decorator, Component, ScrollView, Node, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport UnionCommand from \"./UnionCommand\";\nimport { Member, Union } from \"./UnionProxy\";\nimport { MapCityData } from \"../map/MapCityProxy\";\nimport MapCommand from \"../map/MapCommand\";\nimport UnionMemberItemOpLogic from \"./UnionMemberItemOpLogic\";\nimport { EventMgr } from '../utils/EventMgr';\n\n@ccclass('UnionMemberLogic')\nexport default class UnionMemberLogic extends Component {\n\n    @property(ScrollView)\n    memberView:ScrollView = null;\n\n    @property(Node)\n    disMissButton: Node = null;\n\n    @property(Node)\n    exitButton: Node = null;\n\n    @property(Node)\n    opNode: Node = null;\n\n    protected _op: Node = null;\n\n    protected onLoad():void{\n\n        EventMgr.on(\"update_union_member\",this.updateMember,this);\n        EventMgr.on(\"kick_union_success\",this.getMember,this);\n        EventMgr.on(\"union_appoint\",this.getMember,this);\n        EventMgr.on(\"union_abdicate\",this.getMember,this);\n        EventMgr.on(\"clickUnionMemberItem\",this.onClickItem,this);\n        \n\n    }\n\n    protected onDestroy():void{\n        EventMgr.targetOff(this);\n    }\n\n    protected click():void{\n        if(this._op != null){\n            this._op.active = false;\n        }\n    }\n\n    protected onClickItem(menberData):void{\n        if (this._op == null){\n            var node = instantiate(this.opNode);\n            node.parent = this.node;\n            this._op = node;\n        }\n        this._op.active = true;\n        this._op.getComponent(UnionMemberItemOpLogic).setData(menberData);\n    }\n\n    protected updateMember(data:any[]){\n\n        let city:MapCityData = MapCommand.getInstance().cityProxy.getMyMainCity();\n        let unionData:Union = UnionCommand.getInstance().proxy.getUnion(city.unionId);\n\n        var comp = this.memberView.node.getComponent(\"ListLogic\");\n        var list:Member[] = UnionCommand.getInstance().proxy.getMemberList(unionData.id).concat();\n\n        comp.setData(list);\n\n        this.updateBtn();\n    }\n\n    protected updateBtn(){\n        let city:MapCityData = MapCommand.getInstance().cityProxy.getMyMainCity();\n        let unionData:Union = UnionCommand.getInstance().proxy.getUnion(city.unionId);\n        if(unionData.getChairman().rid == city.rid){\n            this.exitButton.active = false;\n            this.disMissButton.active = true;\n        }else{\n            this.exitButton.active = true;\n            this.disMissButton.active = false;\n        }\n    }\n\n    protected getMember():void{\n        let city:MapCityData = MapCommand.getInstance().cityProxy.getMyMainCity();\n        let unionData:Union = UnionCommand.getInstance().proxy.getUnion(city.unionId);\n        UnionCommand.getInstance().unionMember(unionData.id);\n    }\n\n    protected onEnable():void{\n        this.updateBtn();\n        this.getMember();\n    }\n\n    protected dismiss():void{\n        UnionCommand.getInstance().unionDismiss();\n    }\n\n    protected exit():void{\n        UnionCommand.getInstance().unionExit();\n    }\n\n\n}\n"]}