{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/Main.ts"],"names":["_decorator","Component","Prefab","instantiate","TiledMapAsset","JsonAsset","SpriteFrame","sys","GameConfig","LoaderManager","LoadData","LoadDataType","ArmyCommand","GeneralCommand","LoginCommand","MapCommand","MapUICommand","HttpManager","NetEvent","NetManager","NetNodeType","SkillCommand","Toast","Tools","EventMgr","ccclass","property","Main","onLoad","console","log","on","onEnterMap","enterLogin","onShowToast","ServerRequesting","showWaitNode","ServerRequestSucess","onServerRequest","getInstance","connect","url","serverUrl","type","BaseServer","setWebUrl","webUrl","onDestroy","targetOff","clearData","clearAllScene","_loginScene","loginScenePrefab","parent","node","dataList","push","FILE","DIR","isBrowser","addLoadingNode","startLoadList","error","paths","datas","proxy","tiledMapAsset","initMapResConfig","json","setAllFacilityCfg","initGeneralConfig","initGeneralTex","setBasic","initSkillConfig","d","setWarFree","war_free","cityId","cityProxy","getMyMainCity","qryMyGenerals","qryArmyList","qryWarReport","qrySkillList","_mapScene","mapScenePrefab","_mapUIScene","mapUIScenePrefab","loadingPrefab","_loadingNode","setSiblingIndex","isShow","_waitNode","waitPrefab","active","showTopToast","text","toastNode","toast","toastPrefab","getComponent","setText","msg","code","undefined","_retryTimes","role_enterServer","getSession","getCodeStr","destroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, Prefab, Node, instantiate, TiledMapAsset, JsonAsset, SpriteFrame, sys, UITransform } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport { GameConfig } from \"./config/GameConfig\";\nimport LoaderManager, { LoadData, LoadDataType } from \"./core/LoaderManager\";\nimport ArmyCommand from \"./general/ArmyCommand\";\nimport GeneralCommand from \"./general/GeneralCommand\";\nimport LoginCommand from \"./login/LoginCommand\";\nimport MapCommand from \"./map/MapCommand\";\nimport MapUICommand from \"./map/ui/MapUICommand\";\nimport { HttpManager } from \"./network/http/HttpManager\";\nimport { NetEvent } from \"./network/socket/NetInterface\";\nimport { NetManager } from \"./network/socket/NetManager\";\nimport { NetNodeType } from \"./network/socket/NetNode\";\nimport SkillCommand from \"./skill/SkillCommand\";\nimport Toast from \"./utils/Toast\";\nimport { Tools } from \"./utils/Tools\";\nimport { EventMgr } from './utils/EventMgr';\n\n@ccclass('Main')\nexport default class Main extends Component {\n    @property(Prefab)\n    loginScenePrefab: Prefab = null;\n\n    @property(Prefab)\n    mapScenePrefab: Prefab = null;\n    @property(Prefab)\n    mapUIScenePrefab: Prefab = null;\n\n    @property(Prefab)\n    loadingPrefab: Prefab = null;\n\n\n    @property(Prefab)\n    waitPrefab: Prefab = null;\n\n    @property(Prefab)\n    toastPrefab: Prefab = null;\n\n    private toastNode: Node = null;\n\n    protected _loginScene: Node = null;\n    protected _mapScene: Node = null;\n    protected _mapUIScene: Node = null;\n    protected _loadingNode: Node = null;\n    protected _waitNode: Node = null;\n    private _retryTimes: number = 0;\n\n    protected onLoad(): void {\n\n        console.log(\"main load\");\n        \n\n        EventMgr.on(\"enter_map\", this.onEnterMap, this);\n        EventMgr.on(\"enter_login\", this.enterLogin, this);\n        EventMgr.on(\"show_toast\", this.onShowToast, this);\n        EventMgr.on(NetEvent.ServerRequesting, this.showWaitNode,this);\n        EventMgr.on(NetEvent.ServerRequestSucess,this.onServerRequest,this);\n\n\n        //初始化连接\n        NetManager.getInstance().connect({ url: GameConfig.serverUrl , type:NetNodeType.BaseServer });\n        HttpManager.getInstance().setWebUrl(GameConfig.webUrl);\n\n        //初始化业务模块\n        LoginCommand.getInstance();\n        MapCommand.getInstance();\n        MapUICommand.getInstance();\n        GeneralCommand.getInstance();\n        ArmyCommand.getInstance();\n\n        this.enterLogin();\n       \n    }\n\n    protected onDestroy(): void {\n        EventMgr.targetOff(this);\n    }\n\n    protected clearData(): void {\n        MapCommand.getInstance().clearData();\n        GeneralCommand.getInstance().clearData();\n        ArmyCommand.getInstance().clearData();\n    }\n\n    private enterLogin(): void {\n        this.clearAllScene();\n        this.clearData();\n        this._loginScene = instantiate(this.loginScenePrefab);\n        this._loginScene.parent = this.node;\n    }\n\n    protected onEnterMap(): void {\n        let dataList: LoadData[] = [];\n        dataList.push(new LoadData(\"./world/map\", LoadDataType.FILE, TiledMapAsset));\n        dataList.push(new LoadData(\"./config/mapRes_0\", LoadDataType.FILE, JsonAsset));\n        dataList.push(new LoadData(\"./config/json/facility/\", LoadDataType.DIR, JsonAsset));\n        dataList.push(new LoadData(\"./config/json/general/\", LoadDataType.DIR, JsonAsset));\n        if(sys.isBrowser){\n            dataList.push(new LoadData(\"./generalpic1\", LoadDataType.DIR, SpriteFrame));\n        }else{\n            dataList.push(new LoadData(\"./generalpic\", LoadDataType.DIR, SpriteFrame));\n        }\n       \n        dataList.push(new LoadData(\"./config/basic\", LoadDataType.FILE, JsonAsset));\n        dataList.push(new LoadData(\"./config/json/skill/\", LoadDataType.DIR, JsonAsset));\n\n        this.addLoadingNode();\n        console.log(\"onEnterMap\");\n        LoaderManager.getInstance().startLoadList(dataList, null,\n            (error: Error, paths: string[], datas: any[]) => {\n                if (error != null) {\n                    console.log(\"加载配置文件失败\");\n                    return;\n                }\n                console.log(\"loadComplete\", paths, datas);\n                MapCommand.getInstance().proxy.tiledMapAsset = datas[0] as TiledMapAsset;\n                MapCommand.getInstance().proxy.initMapResConfig((datas[1] as JsonAsset).json);\n\n                MapUICommand.getInstance().proxy.setAllFacilityCfg(datas[2]);\n                GeneralCommand.getInstance().proxy.initGeneralConfig(datas[3],(datas[5] as JsonAsset).json);\n                GeneralCommand.getInstance().proxy.initGeneralTex(datas[4]);\n                MapUICommand.getInstance().proxy.setBasic(datas[5]);\n                SkillCommand.getInstance().proxy.initSkillConfig(datas[6]);\n\n                var d = (datas[5] as JsonAsset).json\n                MapCommand.getInstance().proxy.setWarFree(d[\"build\"].war_free);\n\n                let cityId: number = MapCommand.getInstance().cityProxy.getMyMainCity().cityId;\n                GeneralCommand.getInstance().qryMyGenerals();\n                ArmyCommand.getInstance().qryArmyList(cityId);\n                MapUICommand.getInstance().qryWarReport();\n                SkillCommand.getInstance().qrySkillList();\n\n                this.clearAllScene();\n                this._mapScene = instantiate(this.mapScenePrefab);\n                this._mapScene.parent = this.node;\n                this._mapUIScene = instantiate(this.mapUIScenePrefab);\n                this._mapUIScene.parent = this.node;\n            },\n            this\n        );\n    }\n\n    protected addLoadingNode(): void {\n        if (this.loadingPrefab) {\n            if (this._loadingNode == null) {\n                this._loadingNode = instantiate(this.loadingPrefab);\n            }\n            this._loadingNode.setSiblingIndex(1);\n            this._loadingNode.parent = this.node;\n        }\n    }\n\n\n    protected showWaitNode(isShow:boolean):void{\n        if (this._waitNode == null) {\n            this._waitNode = instantiate(this.waitPrefab);\n            this._waitNode.parent = this.node;\n            this._waitNode.setSiblingIndex(2);\n        }\n        this._waitNode.active = isShow;\n\n    }\n\n\n    protected showTopToast(text:string = \"\"):void{\n        if(this.toastNode == null){\n            let toast = instantiate(this.toastPrefab);\n            toast.parent = this.node;\n            toast.setSiblingIndex(10);\n            this.toastNode = toast;\n        }\n        this.toastNode.active = true;\n        this.toastNode.getComponent(Toast).setText(text);\n    }\n\n\n    private onServerRequest(msg:any):void{\n        if(msg.code == undefined || msg.code == 0 || msg.code == 9){\n            this._retryTimes = 0;\n            return;\n        }\n\n        if(msg.code == -1 || msg.code == -2 || msg.code == -3 || msg.code == -4 ){\n            if (this._retryTimes < 3){\n                LoginCommand.getInstance().role_enterServer(LoginCommand.getInstance().proxy.getSession(), false);\n                this._retryTimes += 1;\n                return\n            }\n        }\n\n        this.showTopToast(Tools.getCodeStr(msg.code));\n    }\n\n    private onShowToast(msg:string) {\n        this.showTopToast(msg);\n    }\n\n    protected clearAllScene() {\n        if (this._mapScene) {\n            this._mapScene.destroy();\n            this._mapScene = null;\n        }\n\n        if (this._mapUIScene) {\n            this._mapUIScene.destroy();\n            this._mapUIScene = null;\n        }\n\n        if (this._loginScene) {\n            this._loginScene.destroy();\n            this._loginScene = null;\n        }\n        \n        if (this._waitNode) {\n            this._waitNode.destroy();\n            this._waitNode = null;\n        }\n        \n    }\n}\n"]}