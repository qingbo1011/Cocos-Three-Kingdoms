{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/map/ui/CityAboutLogic.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","ArmyCommand","CityArmyItemLogic","MapUICommand","EventMgr","ccclass","property","CityAboutLogic","onEnable","initView","on","onUpdateCityAdditon","onDisable","targetOff","i","_armyCnt","item","armyItem","parent","armyLayer","comp","getComponent","order","_armyComps","push","cityId","_cityData","updateArmyList","additon","getInstance","proxy","getMyCityAddition","armyList","getArmyList","length","armyCnt","isOpenedArmy","setArmyData","setData","data","qryCityFacilities","onClickFacility","emit","onClickClose","node","active"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport ArmyCommand from \"../../general/ArmyCommand\";\nimport { ArmyData } from \"../../general/ArmyProxy\";\nimport { MapCityData } from \"../MapCityProxy\";\nimport CityArmyItemLogic from \"./CityArmyItemLogic\";\nimport MapUICommand from \"./MapUICommand\";\nimport { CityAddition } from \"./MapUIProxy\";\nimport { EventMgr } from '../../utils/EventMgr';\n\n@ccclass('CityAboutLogic')\nexport default class CityAboutLogic extends Component {\n    @property(Node)\n    armyLayer: Node = null;\n    @property(Prefab)\n    armyItem: Prefab = null;\n\n    protected _armyCnt: number = 5;//队伍数量 固定值\n    protected _cityData: MapCityData = null;\n    protected _armyComps: CityArmyItemLogic[] = [];\n\n    protected onEnable(): void {\n        this.initView();\n        EventMgr.on(\"update_city_addition\", this.onUpdateCityAdditon, this);\n    }\n\n    protected onDisable(): void {\n        EventMgr.targetOff(this);\n    }\n\n    protected initView(): void {\n        for (let i: number = 0; i < this._armyCnt; i++) {\n            let item = instantiate(this.armyItem);\n            item.parent = this.armyLayer;\n            let comp: CityArmyItemLogic = item.getComponent(CityArmyItemLogic);\n            comp.order = i + 1;\n            this._armyComps.push(comp);\n        }\n    }\n\n    protected onUpdateCityAdditon(cityId: number): void {\n        if (this._cityData.cityId == cityId) {\n            this.updateArmyList();\n        }\n    }\n\n    protected updateArmyList(): void {\n        let additon: CityAddition = MapUICommand.getInstance().proxy.getMyCityAddition(this._cityData.cityId);\n        let armyList: ArmyData[] = ArmyCommand.getInstance().proxy.getArmyList(this._cityData.cityId);\n        for (let i: number = 0; i < this._armyComps.length; i++) {\n            if (i >= additon.armyCnt) {\n                //未开启\n                this._armyComps[i].isOpenedArmy(false, false);\n            } else {\n                //已开启\n                this._armyComps[i].isOpenedArmy(true, false);\n                this._armyComps[i].setArmyData(this._cityData.cityId, armyList[i]);\n            }\n        }\n    }\n\n    public setData(data: MapCityData): void {\n        this._cityData = data;\n        this.updateArmyList();\n        MapUICommand.getInstance().qryCityFacilities(this._cityData.cityId);\n    }\n\n\n    protected onClickFacility(): void {\n        //设施\n        EventMgr.emit(\"open_facility\", this._cityData);\n    }\n\n\n    protected onClickClose(): void {\n        this.node.active = false;\n\n        EventMgr.emit(\"close_city_about\", this._cityData);\n        \n    }\n}\n"]}