{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/union/UnionMainLogic.ts"],"names":["_decorator","Component","Label","Node","EditBox","Button","UnionCommand","MapCommand","EventMgr","ccclass","property","UnionMainLogic","onLoad","on","onUnionNotice","onInfo","onUnionApply","onDestroy","targetOff","onEnable","city","getInstance","cityProxy","getMyMainCity","unionInfo","unionId","updateRedDot","cnt","proxy","getApplyCnt","applyRedDot","active","unionData","getUnion","nameLab","string","name","notice","noticeLab","mengZhuLab","getChairman","editNode","ok","isMajor","rid","modifyBtn","node","applyBtn","data","text","onEditSubmit","str","editBox","modNotice","onModify","onCancel"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, EditBox, Button } from 'cc';\nconst {ccclass, property} = _decorator;\n\nimport UnionCommand from \"./UnionCommand\";\nimport { Union } from \"./UnionProxy\";\nimport { MapCityData } from \"../map/MapCityProxy\";\nimport MapCommand from \"../map/MapCommand\";\nimport { EventMgr } from '../utils/EventMgr';\n\n@ccclass('UnionMainLogic')\nexport default class UnionMainLogic extends Component {\n    @property(Label)\n    nameLab: Label | null = null;\n    @property(Label)\n    mengZhuLab: Label | null = null;\n    @property(Label)\n    noticeLab: Label | null = null;\n    @property(Node)\n    editNode: Node | null = null;\n    @property(EditBox)\n    editBox: EditBox | null = null;\n    @property(Button)\n    modifyBtn: Button | null = null;\n    @property(Button)\n    applyBtn: Button | null = null;\n    @property(Node)\n    applyRedDot: Node | null = null;\n    \n    onLoad () {\n        EventMgr.on(\"union_notice\",this.onUnionNotice,this);\n        EventMgr.on(\"union_info\",this.onInfo, this);\n        EventMgr.on(\"update_union_apply\", this.onUnionApply, this);\n    }\n    \n    protected onDestroy():void{\n        EventMgr.targetOff(this);\n    }\n    onEnable() {\n        let city:MapCityData = MapCommand.getInstance().cityProxy.getMyMainCity();\n        UnionCommand.getInstance().unionInfo(city.unionId);\n        this.updateRedDot()\n    }\n    updateRedDot(){\n        let city:MapCityData = MapCommand.getInstance().cityProxy.getMyMainCity();\n        let cnt = UnionCommand.getInstance().proxy.getApplyCnt(city.unionId);\n        this.applyRedDot.active = cnt > 0;\n    }\n    onInfo(){\n        let city:MapCityData = MapCommand.getInstance().cityProxy.getMyMainCity();\n        let unionData:Union = UnionCommand.getInstance().proxy.getUnion(city.unionId);\n        this.nameLab.string = \"联盟:\" + unionData.name;\n        if (unionData.notice == \"\"){\n        this.noticeLab.string = \"暂无公告\";\n        }else{\n        this.noticeLab.string = unionData.notice;\n        }\n        this.mengZhuLab.string = \"盟主:\" + unionData.getChairman().name\n        this.editNode.active = false;\n\n        let ok = unionData.isMajor(city.rid);\n        this.modifyBtn.node.active = ok;\n        this.applyBtn.node.active = ok;\n    }\n    onUnionNotice(data){\n        this.noticeLab.string = data.text;\n    }\n    onUnionApply(){\n        this.updateRedDot();\n    }\n    onEditSubmit(){\n        this.noticeLab.node.active = true;\n        this.editNode.active = false;\n        this.modifyBtn.node.active = true;\n\n        var str = this.editBox.string\n        UnionCommand.getInstance().modNotice(str);\n    }\n    onModify(){\n        this.noticeLab.node.active = false;\n        this.editNode.active = true;\n        this.modifyBtn.node.active = false;\n    }\n    onCancel(){\n        this.noticeLab.node.active = true;\n        this.editNode.active = false;\n        this.modifyBtn.node.active = true;\n    }\n}\n"]}