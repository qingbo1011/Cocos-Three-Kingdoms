{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/map/ui/GeneralConvertLogic.ts"],"names":["_decorator","Component","ScrollView","Node","Prefab","instantiate","UITransform","Vec3","GeneralCommand","GeneralItemLogic","GeneralItemType","EventMgr","ccclass","property","GeneralConvertLogic","Map","onEnable","initGeneralCfg","on","onSelectGeneral","onGeneralConvert","onDisable","targetOff","onClickClose","node","active","emit","list","getInstance","proxy","getMyGeneralsNotUse","listTemp","concat","forEach","item","type","GeneralSelect","i","length","_cunGeneral","indexOf","id","splice","comp","scrollView","getComponent","setData","cfgData","curData","has","_upMap","obj","get","parent","delete","g","_selectMap","select","size","generalPrefab","width","height","scale","contentNode","set","msg","add_gold","clear","onClickOK","keys","ids","Array","from","convert"],"mappings":"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","sourcesContent":["\n\nimport { _decorator, Component, ScrollView, Node, Prefab, instantiate, UITransform, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport GeneralCommand from \"../../general/GeneralCommand\";\nimport GeneralItemLogic, { GeneralItemType } from \"./GeneralItemLogic\";\nimport { EventMgr } from '../../utils/EventMgr';\n\n@ccclass('GeneralConvertLogic')\nexport default class GeneralConvertLogic extends Component {\n\n    @property(ScrollView)\n    scrollView:ScrollView = null;\n\n    @property(Node)\n    contentNode:Node = null;\n\n    @property(Prefab)\n    generalPrefab = null;\n\n    private _cunGeneral:number[] = [];\n\n    private _upMap:Map<number, Node> = new Map<number, Node>();\n\n    private _selectMap:Map<number, Node> = new Map<number, Node>();\n\n    protected onEnable():void{\n       this.initGeneralCfg();\n       EventMgr.on(\"open_general_select\", this.onSelectGeneral, this);\n       EventMgr.on(\"general_convert\", this.onGeneralConvert, this);\n    }\n\n\n    protected onDisable():void{\n        EventMgr.targetOff(this);\n    }\n\n    protected onClickClose(): void {\n        this.node.active = false;\n        EventMgr.emit(\"open_general\");\n    }\n\n    protected initGeneralCfg():void{\n\n        let list:any[] = GeneralCommand.getInstance().proxy.getMyGeneralsNotUse();\n        let listTemp = list.concat();\n\n        listTemp.forEach(item => {\n            item.type = GeneralItemType.GeneralSelect;\n        })\n\n\n        for(var i = 0; i < listTemp.length ;i++){\n            if(this._cunGeneral.indexOf(listTemp[i].id) >= 0 ){\n                listTemp.splice(i,1);\n                i--;\n            }\n        }\n\n        var comp = this.scrollView.node.getComponent(\"ListLogic\");\n        comp.setData(listTemp);\n    }\n\n    protected onSelectGeneral(cfgData: any, curData: any, node:Node): void {\n        //console.log(\"curData:\", curData, this._upMap.size);\n\n        var has = this._upMap.has(curData.id);\n        if (has){\n            var obj = this._upMap.get(curData.id);\n            obj.parent = null;\n            this._upMap.delete(curData.id);\n\n            var g = this._selectMap.get(curData.id);\n            if (g){\n                g.getComponent(GeneralItemLogic).select(false);\n            }\n\n        }else{\n\n            if (this._upMap.size >= 9){\n                node.getComponent(GeneralItemLogic).select(false);\n                return\n            }\n\n            var g:Node = instantiate(this.generalPrefab);\n            g.getComponent(GeneralItemLogic).setData(curData,  GeneralItemType.GeneralSelect);\n            g.getComponent(GeneralItemLogic).select(true);\n            g.getComponent(UITransform).width *=0.5;\n            g.getComponent(UITransform).height*=0.5;\n            g.scale = new Vec3(0.5, 0.5, 0.5);\n            g.parent = this.contentNode;\n            this._upMap.set(curData.id, g);\n            this._selectMap.set(curData.id, node);\n        }\n    }\n\n   \n    protected onGeneralConvert(msg:any):void{\n        EventMgr.emit(\"show_toast\", \"获得金币:\"+msg.add_gold);\n        this._upMap.forEach((g:Node) => {\n            g.parent = null;\n        });\n\n        this._upMap.clear();\n        this._selectMap.clear();\n\n        this.initGeneralCfg();\n    }\n\n    protected onClickOK():void{\n        var keys = this._upMap.keys();\n        var ids = Array.from(keys);\n        GeneralCommand.getInstance().convert(ids);\n    }\n    \n\n}\n"]}