{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/map/ui/GeneralDesLogic.ts"],"names":["_decorator","Component","Label","Layout","Prefab","Node","instantiate","GeneralCommand","GeneralData","SkillCommand","GeneralItemLogic","GeneralItemType","SkillIconLogic","EventMgr","ccclass","property","GeneralDesLogic","onEnable","on","updateGeneral","onDisable","targetOff","onLoad","_nameObj","force","strategy","defense","speed","destroy","_generalNode","generalItemPrefab","parent","generalItemParent","data","getInstance","proxy","getMyGeneral","_currData","id","setData","_cfgData","cfgData","curData","nextCfg","getGeneralLevelCfg","level","levelExp","exp","maxLevel","getMaxLevel","lvLabel","string","expLabel","nameLab","name","_addPrObj","force_added","strategy_added","defense_added","speed_added","destroy_added","foreLabel","getAttrStr","strategyLabel","defenseLabel","speedLabel","destroyLabel","com","getComponent","updateItem","GeneralNoThing","powerLabel","physical_power","physical_power_limit","costLabel","cost","index","skills","length","gSkill","icon","skillIcons","iconNameLab","skillNameLab","skillConf","getSkillCfg","cfgId","skill","getSkill","key","str","getPrStr","onClickSkill","event","pos","console","log","node","target","isEmpty","emit"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Layout, Prefab, Node, EventTouch, instantiate } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport GeneralCommand from \"../../general/GeneralCommand\";\nimport {GeneralData } from \"../../general/GeneralProxy\";\nimport SkillCommand from \"../../skill/SkillCommand\";\nimport GeneralItemLogic, { GeneralItemType } from \"./GeneralItemLogic\";\nimport SkillIconLogic from \"./SkillIconLogic\";\nimport { EventMgr } from '../../utils/EventMgr';\n\n@ccclass('GeneralDesLogic')\nexport default class GeneralDesLogic extends Component {\n  \n    @property(Label)\n    nameLab: Label = null;\n\n    @property(Layout)\n    srollLayout:Layout = null;\n\n    @property(Label)\n    lvLabel: Label = null;\n    \n    @property(Label)\n    foreLabel: Label = null;\n\n    @property(Label)\n    defenseLabel: Label = null;\n\n    @property(Label)\n    speedLabel: Label = null;\n\n    @property(Label)\n    strategyLabel: Label = null;\n\n    @property(Label)\n    destroyLabel: Label = null;\n\n    @property(Label)\n    expLabel: Label = null;\n\n    @property(Label)\n    powerLabel: Label = null;\n\n    @property(Label)\n    costLabel: Label = null;\n\n\n    @property(Prefab)\n    generalItemPrefab: Prefab = null;\n\n    @property(Node)\n    generalItemParent: Node = null;\n\n    @property([Node])\n    skillIcons: Node[] = [];\n\n    @property([Label])\n    skillNameLab: Label[] = [];\n\n    private _currData:GeneralData = null;\n    private _cfgData:any = null;\n\n\n    private _nameObj:any = {};\n    private _addPrObj:any = {};\n    private _generalNode:Node = null;\n\n    protected onEnable(){\n        EventMgr.on(\"update_general\", this.updateGeneral, this)\n    }\n\n    protected onDisable(){\n        EventMgr.targetOff(this);\n    }\n\n    protected onLoad():void{\n\n        this._nameObj = {\n            force:\"武力\",\n            strategy:\"战略\",\n            defense:\"防御\",\n            speed:\"速度\",\n            destroy:\"破坏\",\n        };\n       \n        this._generalNode = instantiate(this.generalItemPrefab);\n        this._generalNode.parent = this.generalItemParent;\n    }\n\n    protected updateGeneral(){\n        var data = GeneralCommand.getInstance().proxy.getMyGeneral(this._currData.id);\n        if(data){\n            this.setData(this._cfgData, data);\n        }\n    }\n\n    public setData(cfgData:any, curData:GeneralData):void{\n        this._currData = curData;\n        this._cfgData = cfgData;\n    \n        var nextCfg = GeneralCommand.getInstance().proxy.getGeneralLevelCfg(this._currData.level + 1);\n        var levelExp = nextCfg?nextCfg.exp:\"MAX\";\n        var maxLevel: number = GeneralCommand.getInstance().proxy.getMaxLevel();\n        this.lvLabel.string = '等级:' + this._currData.level + \"/\" + maxLevel;\n        this.expLabel.string = \"经验:\" + curData.exp +\"/\" + levelExp;\n        \n        this.nameLab.string = this._cfgData.name;\n\n        this._addPrObj = {\n            force:this._currData.force_added,\n            strategy:this._currData.strategy_added,\n            defense:this._currData.defense_added,\n            speed:this._currData.speed_added,\n            destroy:this._currData.destroy_added,\n        };\n\n       \n        this.foreLabel.string = this.getAttrStr(\"force\");\n        this.strategyLabel.string = this.getAttrStr(\"strategy\");\n        this.defenseLabel.string = this.getAttrStr(\"defense\");\n        this.speedLabel.string = this.getAttrStr(\"speed\");\n        this.destroyLabel.string = this.getAttrStr(\"destroy\");\n     \n        var com = this._generalNode.getComponent(GeneralItemLogic);\n        if(com){\n            com.updateItem(this._currData, GeneralItemType.GeneralNoThing);\n        }\n\n        this.powerLabel.string = \"体力:\" + curData.physical_power + \"/\" + cfgData.physical_power_limit;\n        this.costLabel.string = \"cost:\"+cfgData.cost;\n\n        for (let index = 0; index < curData.skills.length; index++) {\n            let gSkill = curData.skills[index];\n            let icon = this.skillIcons[index];\n            let iconNameLab = this.skillNameLab[index];\n\n            if(gSkill == null){\n                icon.getComponent(SkillIconLogic).setData(null, null);\n                iconNameLab.string = \"\";\n            }else{\n                \n                let skillConf = SkillCommand.getInstance().proxy.getSkillCfg(gSkill.cfgId);\n                let skill = SkillCommand.getInstance().proxy.getSkill(gSkill.cfgId);\n                if(skillConf && skill){\n                    icon.getComponent(SkillIconLogic).setData(skill, gSkill);\n                    iconNameLab.string = skillConf.name;\n                }else{\n                    icon.getComponent(SkillIconLogic).setData(null, null);\n                    iconNameLab.string = \"\";\n                }\n            }\n        }\n    }\n\n    private getAttrStr(key: string) :string{\n        var str = GeneralData.getPrStr(this._cfgData[key], this._addPrObj[key], this._currData.level, this._cfgData[key + \"_grow\"])\n        return this._nameObj[key] + \":\" + str;\n    }\n\n    protected onClickSkill(event: EventTouch, pos){\n        console.log(\"event\", event, pos);\n        var node: Node = event.target;\n        var isEmpty = node.getComponent(SkillIconLogic).isEmpty();\n        if(isEmpty){\n            EventMgr.emit(\"open_skill\", 1, this._currData, pos);\n        }else{\n            let skill = node.getComponent(SkillIconLogic).getSkill();\n            EventMgr.emit(\"open_skillInfo\", skill, 2, this._currData, pos);\n        }\n    }\n\n}\n"]}