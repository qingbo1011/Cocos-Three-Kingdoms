{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/map/ui/CollectLogic.ts"],"names":["_decorator","Component","Label","Button","LoginCommand","DateUtil","Tools","MapUICommand","EventMgr","ccclass","property","CollectLogic","onEnable","console","log","on","onOpenCollect","onCollect","roleRes","getInstance","proxy","getRoleResData","goldLab","string","numberToShow","gold_yield","interiorOpenCollect","onDisable","targetOff","msg","_data","startCountDown","onClickClose","node","active","onClickCollect","interiorCollect","stopCountDown","schedule","countDown","timesLab","cur_times","limit","diff","leftTime","next_time","cdLab","leftTimeStr","collectBtn","interactable","unschedule"],"mappings":"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","sourcesContent":["// // Learn TypeScript:\n// //  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\n// // Learn Attribute:\n// //  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// // Learn life-cycle callbacks:\n// //  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport { _decorator, Component, Label, Button } from 'cc';\nconst {ccclass, property} = _decorator;\n\nimport LoginCommand from \"../../login/LoginCommand\";\nimport DateUtil from \"../../utils/DateUtil\";\nimport { Tools } from \"../../utils/Tools\";\nimport MapUICommand from \"./MapUICommand\";\nimport { EventMgr } from '../../utils/EventMgr';\n\n@ccclass('CollectLogic')\nexport default class CollectLogic extends Component {\n\n    @property(Label)\n    cdLab: Label = null;\n\n    @property(Label)\n    timesLab: Label = null;\n\n    @property(Label)\n    goldLab: Label = null;\n\n    @property(Button)\n    collectBtn: Button = null;\n\n    _data: any = null;\n\n    protected onEnable():void{\n        console.log(\"add interior_openCollect\");\n        EventMgr.on(\"interior_openCollect\", this.onOpenCollect, this);\n        EventMgr.on(\"interior_collect\", this.onCollect, this);\n\n        var roleRes = LoginCommand.getInstance().proxy.getRoleResData();\n        this.goldLab.string = Tools.numberToShow(roleRes.gold_yield);\n\n        MapUICommand.getInstance().interiorOpenCollect();\n    }\n\n\n    protected onDisable():void{\n        EventMgr.targetOff(this);\n    }\n\n    protected onOpenCollect(msg:any):void{\n        console.log(\"onOpenCollect:\", msg);\n        this._data = msg;\n        this.startCountDown();\n    }\n\n    protected onCollect(msg:any):void{\n        console.log(\"onOpenCollect:\", msg);\n        this._data = msg;\n        this.startCountDown();\n    }\n\n    protected onClickClose(): void {\n        this.node.active = false;\n    }\n\n    protected onClickCollect(): void{\n        MapUICommand.getInstance().interiorCollect();\n    }\n\n    protected startCountDown(){\n        this.stopCountDown();\n        this.schedule(this.countDown, 1.0);\n        this.countDown();\n    }\n\n    public countDown() {\n        this.timesLab.string = this._data.cur_times + \"/\" + this._data.limit;\n        var diff = DateUtil.leftTime(this._data.next_time);\n        if (diff>0){\n            this.cdLab.string = DateUtil.leftTimeStr(this._data.next_time);\n            this.collectBtn.interactable = false;\n        }else{\n            this.cdLab.string = \"目前可以征收\";\n            this.collectBtn.interactable = true;\n        }\n    }\n\n    public stopCountDown() {\n        this.unschedule(this.countDown);\n    }\n\n}\n"]}