{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/map/ui/GeneralListLogic.ts"],"names":["_decorator","Component","ScrollView","Label","GeneralCommand","MapUICommand","EventMgr","ccclass","property","GeneralListLogic","onEnable","on","initGeneralCfg","onClickClose","onDisable","targetOff","node","active","onClickConvert","emit","onTuJianConvert","basic","getInstance","proxy","getBasicGeneral","cnt","getMyActiveGeneralCnt","cntLab","string","limit","list","getUseGenerals","listTemp","concat","forEach","item","type","_type","position","_position","i","length","_cunGeneral","indexOf","id","splice","comp","scrollView","getComponent","setData","data","qryMyGenerals"],"mappings":"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","sourcesContent":["\nimport { _decorator, Component, ScrollView, Label } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport GeneralCommand from \"../../general/GeneralCommand\";\nimport MapUICommand from \"./MapUICommand\";\nimport { EventMgr } from '../../utils/EventMgr';\n\n@ccclass('GeneralListLogic')\nexport default class GeneralListLogic extends Component {\n\n    @property(ScrollView)\n    scrollView:ScrollView = null;\n\n    @property(Label)\n    cntLab:Label = null;\n\n    private _cunGeneral:number[] = [];\n    private _type:number = 0;\n    private _position:number = 0;\n\n    protected onEnable():void{\n        EventMgr.on(\"update_my_generals\", this.initGeneralCfg, this);\n        EventMgr.on(\"general_convert\", this.initGeneralCfg, this);\n        EventMgr.on(\"chosed_general\", this.onClickClose, this);\n    }\n\n\n    protected onDisable():void{\n        EventMgr.targetOff(this);\n    }\n\n    protected onClickClose(): void {\n        this.node.active = false;\n    }\n\n    protected onClickConvert(): void {\n        EventMgr.emit(\"open_general_convert\");\n        this.node.active = false;\n    }\n\n    protected onTuJianConvert(): void {\n        EventMgr.emit(\"open_general_roster\");\n        this.node.active = false;\n    }\n\n    protected initGeneralCfg():void{\n\n        var basic = MapUICommand.getInstance().proxy.getBasicGeneral();\n        var cnt = GeneralCommand.getInstance().proxy.getMyActiveGeneralCnt();\n        this.cntLab.string = \"(\" + cnt + \"/\" + basic.limit + \")\";\n\n        let list:any[] = GeneralCommand.getInstance().proxy.getUseGenerals();\n        let listTemp = list.concat();\n\n\n        listTemp.forEach(item => {\n            item.type = this._type;\n            item.position = this._position;\n        })\n\n\n        for(var i = 0; i < listTemp.length ;i++){\n            if(this._cunGeneral.indexOf(listTemp[i].id) >= 0 ){\n                listTemp.splice(i,1);\n                i--;\n            }\n        }\n\n        var comp = this.scrollView.node.getComponent(\"ListLogic\");\n        comp.setData(listTemp);\n    }\n\n\n\n    public setData(data:number[],type:number = 0,position:number = 0):void{\n        this._cunGeneral = [];\n        if(data && data.length > 0){\n            this._cunGeneral = data;\n        }\n        \n        this._type = type;\n        this._position = position;\n\n        this.initGeneralCfg();\n        GeneralCommand.getInstance().qryMyGenerals();\n    }\n\n}\n"]}