{"version":3,"sources":["file:///D:/git/github/mszlu/games/slg/ms-sg/assets/scripts/map/MapSysCityLogic.ts"],"names":["_decorator","Vec2","Vec3","MapBaseLayerLogic","MapUtil","SysCityLogic","EventMgr","ccclass","property","MapSysCityLogic","onLoad","on","onUpdateBuilds","onUpdateBuild","onDeleteBuild","onDestroy","targetOff","areaIndex","addIds","removeIds","updateIds","_itemMap","has","i","length","addItem","_cmd","buildProxy","getBuild","removeItem","updateItem","data","getAreaIdByCellPoint","x","y","id","console","log","setItemData","item","cityData","position","mapCellToPixelPoint","setPosition","getComponent","setCityData","getIdByData"],"mappings":"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","sourcesContent":["import { _decorator, Node, Vec2, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\n\nimport MapBaseLayerLogic from \"./MapBaseLayerLogic\";\nimport MapUtil from \"./MapUtil\";\nimport SysCityLogic from \"./entries/SysCityLogic\";\nimport { MapBuildData } from \"./MapBuildProxy\";\nimport { EventMgr } from '../utils/EventMgr';\n\n@ccclass('MapSysCityLogic')\nexport default class MapSysCityLogic extends MapBaseLayerLogic {\n\n    protected onLoad(): void {\n        super.onLoad();\n        EventMgr.on(\"update_builds\", this.onUpdateBuilds, this);\n        EventMgr.on(\"update_build\", this.onUpdateBuild, this);\n        EventMgr.on(\"delete_build\", this.onDeleteBuild, this);\n\n    }\n\n    protected onDestroy(): void {\n        EventMgr.targetOff(this);\n        super.onDestroy();\n    }\n\n    protected onUpdateBuilds(areaIndex: number, addIds: number[], removeIds: number[], updateIds: number[]): void {\n  \n        if (this._itemMap.has(areaIndex)) {\n            for (let i: number = 0; i < addIds.length; i++) {\n                this.addItem(areaIndex, this._cmd.buildProxy.getBuild(addIds[i]));\n            }\n            for (let i: number = 0; i < removeIds.length; i++) {\n                this.removeItem(areaIndex, removeIds[i]);\n            }\n            for (let i: number = 0; i < updateIds.length; i++) {\n                this.updateItem(areaIndex, this._cmd.buildProxy.getBuild(updateIds[i]));\n            }\n        }\n    }\n\n    protected onUpdateBuild(data: MapBuildData): void {\n        // console.log(\"update_build\", data);\n        let areaIndex: number = MapUtil.getAreaIdByCellPoint(data.x, data.y);\n        this.addItem(areaIndex, data);\n    }\n\n    protected onDeleteBuild(id: number, x: number, y: number): void {\n        console.log(\"onDeleteBuild\");\n        let areaIndex: number = MapUtil.getAreaIdByCellPoint(x, y);\n        this.removeItem(areaIndex, id);\n    }\n\n    public setItemData(item: Node, data: any): void {\n        let cityData: MapBuildData = data as MapBuildData;\n        let position: Vec2 = MapUtil.mapCellToPixelPoint(new Vec2(cityData.x, cityData.y));\n        item.setPosition(new Vec3(position.x, position.y, 0));\n        item.getComponent(SysCityLogic).setCityData(cityData);\n    }\n\n    public getIdByData(data: any): number {\n        return (data as MapBuildData).id;\n    }\n}\n"]}